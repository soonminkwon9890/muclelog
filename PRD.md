# 제품 요구사항 정의서 (PRD)

작성일: 2025년 12월 11일

최종 수정일: 2025년 12월 11일 (Tech Stack 확정 및 통합 업데이트)

작성자: Product Manager (Gemini)

문서 버전: v1.7 (Tech Stack: Flutter + Supabase + MediaPipe)

---

## [제품명: MuscleLog (머슬로그) - AI 동작 기반 근육 분석 리포트]

### 1. Overview (개요)

### Problem Statement (문제 정의)

- **문제 정의:** 중급자 이상의 운동인들이 변형된 자세나 특정 루틴을 수행할 때, 주동근/협력근/길항근이 의도대로 사용되고 있는지 객관적으로 확인할 방법이 부재함.
- **왜 중요한가:** 감(Feel)에 의존한 운동은 효율 저하 및 불균형을 초래함. 사용자는 '교정'이 아니라 자신의 수행 능력에 대한 '객관적 데이터'를 갈망함.
- **타겟 고객:** 20~40대 피트니스 고관여층 (직장인, 아마추어 보디빌더, 트레이너).
- **전략적 적합성:** 레드오션인 '코칭/강의' 시장을 피해, 블루오션인 '분석/기록' 시장을 선점하여 1인 창업으로서 리스크를 최소화하고 기술적 엣지를 확보함.
- **핵심 전제/가정:** 사용자는 정확한 분석을 위해 '카메라 고정'과 '촬영 가이드라인'을 준수할 의향이 있다.

### Proposed Work (솔루션 & 기술 전략)

- **솔루션 개요:**
  - 사용자가 영상을 업로드하면 **Google MediaPipe**가 관절 좌표를 추출하고, 이를 자체 알고리즘(각도→근육 활성도 변환)으로 분석합니다.
  - 분석 결과는 새로운 영상을 렌더링하는 것이 아니라, 앱 내에서 원본 영상 위에 **오버레이(Overlay) 방식**으로 그래프와 뼈대를 덧그려 보여줍니다.
- **핵심 기능:**
  1. **AI 영상 분석 (MediaPipe):** 영상 내 관절(Keypoints)의 좌표를 0.01초 단위로 추적.
  2. **커스텀 운동 DB (Supabase):** 사용자가 정의한 운동 이름과 분석 데이터를 RDB 형태로 체계적 관리.
  3. **성장 비교 리포트:** 과거와 현재의 수행 능력(근육 사용 %) 차이를 수치와 그래프로 시각화.

### **System Architecture (시스템 구조)**

- **Frontend (App):** Flutter (Android/iOS)
- **Backend / DB:** **Supabase** (Auth, Database, Storage)
- **AI Engine:** Python (FastAPI + Google MediaPipe) - 별도 연산 서버 구성
- **Data Flow:**
  1. [App] 영상 촬영 → [Supabase Storage] 업로드
  2. [AI Server] 영상 다운로드 → [MediaPipe] 좌표 추출 → [Algorithm] 근육 % 계산
  3. [AI Server] 분석 결과(JSON) → [Supabase DB] 저장
  4. [App] 결과(JSON) 로드 → 영상 위에 실시간 드로잉(Overlay)

### **User Flow (상세 사용자 흐름)**

**Phase 1: 진입 및 인증 (Onboarding)**

1. **[스플래시 화면]** → **[액션: 앱 실행]** → **[결과: 로고 노출 후 로그인 화면 진입]**
2. **[로그인 화면]** → **[액션: '시작하기']** → **[결과: Supabase Auth 연동 소셜 로그인(구글/카카오)]**
3. **[회원가입 완료]** → **[결과: Supabase `Users` 테이블 생성 후 메인 대시보드 이동]**

**Phase 2: 핵심 기능 - 영상 분석 (Core Loop)**

1. **[메인 대시보드]** → **[액션: (+) 버튼 클릭]** → **[결과: 갤러리/카메라 선택 (image_picker)]**
2. **[미디어 선택창]** → **[액션: 영상 선택 및 업로드]** → **[결과: Supabase Storage로 전송]**
3. **[운동 설정 페이지]**
   - **[액션 1]** 운동 이름 입력 (예: "변형 덤벨 컬")
   - **[액션 2]** '가이드 준수' 체크 (필수)
   - **[액션 3]** '분석 시작' 클릭 → **[결과: AI 서버로 Webhook/Request 전송, 로딩 화면 진입]**
4. **[로딩 화면]** → **[액션: 대기 (AI 분석 진행)]** → **[결과: 분석 완료 시 DB 상태 업데이트 감지 → 결과 리포트 자동 전환]**

**Phase 3: 결과 확인 (Consumption via Overlay)**

1. **[결과 리포트 페이지]** → **[액션: 재생 버튼 클릭]** → **[결과: 원본 영상 재생 + 그 위에 뼈대/근육 활성도 그래프가 싱크에 맞춰 그려짐]**
2. **[저장]** → **[액션: '기록 저장']** → **[결과: DB에 영구 보관]**

**Phase 4: 히스토리 비교 (Retention)**

1. **[내 기록]** → **[액션: 특정 운동 선택]** → **[결과: 날짜별 근육 사용률 변화 추이 그래프]**
2. **[비교하기]** → **[액션: 두 날짜 선택]** → **[결과: A영상과 B영상의 데이터 오버랩 비교]**

### **Admin Flow (관리자 흐름)**

1. **[진입]** 별도 관리자 계정 로그인.
2. **[데이터 관리]** Supabase 대시보드와 유사한 형태로 사용자 테이블 및 영상 로그 조회.
3. **[모니터링]** 일일 API 호출량 및 스토리지 용량 확인.

---

### 2. Decision / Risk (의사결정 및 리스크)

### Stakeholders (이해관계자)

- **직접:** 창업자(PM), AI/백엔드 개발자(또는 AI Coding Tool), 초기 사용자.
- **간접:** Supabase (BaaS 제공사), Google (MediaPipe 기술 제공).

### Risk Analysis (상세 위험 분석)

| **위험 요소 (Risk Factor)** | **발생 가능성** | **영향도** | **대응 방안 (Action Items)** | **책임자** |
| --------------------------- | --------------- | ---------- | ---------------------------- | ---------- |

| **1. 신체 가림 (Occlusion)**
(MediaPipe 인식 실패) | **높음** | 높음 | 1. 촬영 가이드(45도 측면/정면 권장) 엄격 적용. 2. 특정 관절이 가려져 좌표가 튀면, 이전 프레임 값을 참고해 보정(Smoothing)하는 알고리즘 적용. | 개발 |
| **2. 오버레이 싱크 불일치**
(영상과 그래프 박자 안 맞음) | 중간 | 중간 | 1. 분석 결과 JSON에 '타임스탬프(ms)'를 정확히 포함. 2. Flutter 앱 영상 플레이어의 현재 시간과 데이터 타임스탬프를 1:1 동기화. | 개발 |
| **3. 데이터베이스 보안**
(내 영상 남이 봄) | 낮음 | **치명적** | 1. **Supabase RLS(Row Level Security)** 정책 필수 설정. 2. `auth.uid() == user_id`인 경우만 조회 가능하도록 제한. | 개발 |
| **4. 법적 리스크**
(의료 행위 오인) | 낮음 | 치명적 | 1. 앱 내 모든 결과창에 "본 결과는 추정치이며 의학적 진단이 아님" 문구 고정 노출. | PM |

### Dependencies (의존성 및 데이터)

- **Core Tech:** Flutter, Supabase, Google MediaPipe.
- **Data Structure (Supabase PostgreSQL ERD):**
  - _아래 코드는 Supabase SQL Editor에 바로 사용 가능합니다._

SQL

- `- 1. 사용자 테이블 (Supabase Auth와 연동)
CREATE TABLE public.users ( id UUID REFERENCES auth.users NOT NULL PRIMARY KEY, -- Supabase Auth UID 사용 email TEXT, nickname TEXT, role TEXT CHECK (role IN ('USER', 'ADMIN')) DEFAULT 'USER', created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
-- 2. 운동 정의 테이블
CREATE TABLE public.exercises ( exercise_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, user_id UUID REFERENCES public.users(id), exercise_name TEXT NOT NULL, target_muscle_group TEXT, -- 예: "Back", "Biceps" created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
-- 3. 분석 기록 테이블 (핵심: 결과 요약 + 상세 데이터 경로)
CREATE TABLE public.analysis_logs ( log_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, user_id UUID REFERENCES public.users(id) NOT NULL, exercise_id BIGINT REFERENCES public.exercises(exercise_id), video_path TEXT NOT NULL, -- Supabase Storage 내 파일 경로 -- 분석 결과 요약 (검색 및 그래프용) agonist_avg_score FLOAT, -- 주동근 평균 사용률 consistency_score FLOAT, -- 반복 일관성 점수 -- 상세 데이터 (오버레이용 좌표 및 프레임별 데이터) analysis_json_path TEXT, -- Storage에 저장된 상세 JSON 파일 경로 (또는 JSONB 컬럼 사용 가능) status TEXT CHECK (status IN ('UPLOADING', 'PROCESSING', 'COMPLETED', 'FAILED')) DEFAULT 'UPLOADING', created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
-- 4. RLS (보안 정책 예시 - 본인 데이터만 조회)
ALTER TABLE public.analysis_logs ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view their own logs" ON public.analysis_logs FOR SELECT USING (auth.uid() = user_id);`

---

### 3. Success Criteria (성공 기준 - SMART)

### 1) 기술 지표: MediaPipe 분석 성공률

- **Specific:** 가이드 준수 영상의 관절 좌표 추출 성공 및 DB 저장 비율.
- **Measurable:** `(좌표 추출 성공 수 / 전체 분석 시도 수) * 100`
- **Target:** 90% 이상 (가려짐 현상 제외).
- **Time-bound:** MVP 출시 1개월 내 최적화.

### 2) 사용자 지표: 오버레이 경험 만족도

- **Specific:** "영상 위에 그려진 그래프가 동작과 잘 맞아떨어지는가?"
- **Measurable:** 결과 페이지 이탈률(Bounce Rate) 및 별점.
- **Target:** 평균 4.0점 이상.

### 3) 비즈니스 지표: 재방문율 (Retention)

- **Specific:** 1주일 내 재접속하여 추가 영상을 분석하는 비율.
- **Target:** 30% 이상.

---

### 4. Definition of Done (완료 조건)

### 필수 조건 (Done - MVP 출시 기준)

- [Infra] Supabase 프로젝트 생성 및 Table, Storage, RLS 설정 완료.
- [App] Flutter 앱에서 영상 촬영/업로드 및 리스트 뷰 구현.
- [AI] Python 서버에서 MediaPipe 연동 및 각도→퍼센트 변환 로직 구현.
- [Client] 앱에서 JSON 데이터를 받아 영상 위에 선(Line)을 그리는 오버레이 플레이어 구현.

### 개선 필요 (but 출시 가능)

- 복잡한 3D 아바타 시각화 (MVP는 2D 선과 점으로 표현).
- 실시간 스트리밍 분석 (MVP는 녹화 후 분석).

### 치명적 (출시 불가)

- 영상과 오버레이 그림의 싱크가 1초 이상 어긋나는 경우.
- 분석 시간이 영상 길이의 3배를 초과하는 경우.

---

### 5. Nope (하지 않을 것 - Out of Scope)

- **기능명: 서버 사이드 영상 렌더링 (Server-side Rendering)**
  - **이유:** 서버 비용 과다 발생, 속도 저하, 수정 불가능.
  - **대안:** **클라이언트 사이드 오버레이 (Client-side Overlay)** 방식 채택.
- **기능명: 타사 유료 API 사용 (Sency, Zenia 등)**
  - **이유:** 커스텀 운동 분석 불가, 높은 종량제 비용.
  - **대안:** **자체 개발 로직 (MediaPipe + Python Custom Logic)** 사용.
- **기능명: AI 티칭/교정**
  - **이유:** 법적 리스크.
  - **대안:** 데이터 시각화 제공에만 집중.

---

### 6. Post-Launch Plan (출시 후 계획)

- **v1.1 (Quick Wins):** 오버레이 디자인 개선 (형광색 등 가시성 확보), 분석 속도 20% 단축.
- **v2.0 (Major Features):** 트레이너용 회원 관리 페이지 (웹), 구독형 프리미엄 기능(무제한 저장소).
- **v3+ (Vision):** 웨어러블 데이터와 영상 데이터의 통합 분석.
